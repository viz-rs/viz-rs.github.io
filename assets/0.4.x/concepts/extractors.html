<article class=flex-1><h1 id=提取器>提取器<a class=anchor href=#提取器>#</a></h1><p>提取器的用途是从 HTTP 请求中提取数据。</p><h2 id=接口定义>接口定义<a class=anchor href=#接口定义>#</a></h2><div class=code><button class="i-lucide-copy transition w-4 h-4 select-none absolute top-4 right-2 op-20 hover:op-80"></button><pre class=language-rust><code><span class=line><span class=punctuation.bracket>#</span><span class=punctuation.bracket>[</span><span class=function.macro>async_trait</span><span class=punctuation.bracket>]</span>
</span><span class=line><span class=keyword>pub</span> <span class=keyword>trait</span> <span class=type>FromRequest</span>: <span class=type>Sized</span> <span class=punctuation.bracket>{</span>
</span><span class=line>    <span class=comment>/// 当提取失败时，返回错误信息</span>
</span><span class=line>    <span class=keyword>type</span> <span class=type>Error</span>: <span class=type>IntoResponse</span><span class=punctuation.delimiter>;</span>
</span><span class=line>
</span><span class=line>    <span class=comment>/// 从 HTTP 请求中提取数据，返回该类型</span>
</span><span class=line>    <span class=punctuation.bracket>#</span><span class=punctuation.bracket>[</span><span class=function.macro>must_use</span><span class=punctuation.bracket>]</span>
</span><span class=line>    <span class=keyword>async</span> <span class=keyword.function>fn</span> <span class=function>extract</span><span class=punctuation.bracket>(</span><span class=parameter>req</span>: <span class=keyword>&</span><span class=keyword>mut</span> <span class=type>Request</span><span class=punctuation.bracket>)</span> <span class=operator>-></span> <span class=type>Result</span><span class=punctuation.bracket><</span><span class=type>Self</span><span class=punctuation.delimiter>,</span> <span class=type>Self</span><span class=punctuation.delimiter>::</span><span class=type>Error</span><span class=punctuation.bracket>></span><span class=punctuation.delimiter>;</span>
</span><span class=line><span class=punctuation.bracket>}</span>
</span></code></pre></div><h2 id=提取函数>提取函数<a class=anchor href=#提取函数>#</a></h2><p>通过 <a href=https://docs.rs/viz/latest/viz/trait.RequestExt.html#tymethod.extract><code>extract</code></a> 函数提取信息。</p><div class=code><button class="i-lucide-copy transition w-4 h-4 select-none absolute top-4 right-2 op-20 hover:op-80"></button><pre class=language-rust><code><span class=line><span class=keyword>async</span> <span class=keyword.function>fn</span> <span class=function>show_user</span><span class=punctuation.bracket>(</span><span class=keyword>mut</span> <span class=parameter>req</span>: <span class=type>Request</span><span class=punctuation.bracket>)</span> <span class=operator>-></span> <span class=type>Result</span><span class=punctuation.bracket><</span><span class=type>Resposne</span><span class=punctuation.bracket>></span> <span class=punctuation.bracket>{</span>
</span><span class=line>  <span class=keyword>let</span> <span class=variable>id</span> <span class=operator>=</span> <span class=parameter>req</span><span class=punctuation.delimiter>.</span><span class=function>extract</span><span class=punctuation.delimiter>::</span><span class=punctuation.bracket><</span><span class=type>Params</span><span class=punctuation.bracket><</span><span class=type.builtin>u32</span><span class=punctuation.bracket>></span><span class=punctuation.bracket>></span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>.</span><span class=keyword.return>await</span>?<span class=punctuation.delimiter>;</span>
</span><span class=line>  <span class=type>Ok</span><span class=punctuation.bracket>(</span><span class=type>Resposne</span><span class=punctuation.delimiter>::</span><span class=function>text</span><span class=punctuation.bracket>(</span><span class=function.macro>format</span><span class=function.macro>!</span><span class=punctuation.bracket>(</span><span class=string>"id: {id}"</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span>
</span><span class=line><span class=punctuation.bracket>}</span>
</span></code></pre></div><h2 id=自定义类型>自定义类型<a class=anchor href=#自定义类型>#</a></h2><p>通过定义新类型，实现 <a href=https://docs.rs/viz/latest/viz/trait.FromRequest.html><code>FromRequest</code></a> 特征来提取信息。</p><div class=code><button class="i-lucide-copy transition w-4 h-4 select-none absolute top-4 right-2 op-20 hover:op-80"></button><pre class=language-rust><code><span class=line><span class=punctuation.bracket>#</span><span class=punctuation.bracket>[</span><span class=function.macro>derive</span><span class=punctuation.bracket>(</span><span class=type>Debug</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>]</span>
</span><span class=line><span class=keyword>struct</span> <span class=type>RequestInfo</span> <span class=punctuation.bracket>{</span>
</span><span class=line>    <span class=keyword>pub</span> <span class=variable>method</span>: <span class=type>String</span><span class=punctuation.delimiter>,</span>
</span><span class=line>    <span class=keyword>pub</span> <span class=variable>path</span>: <span class=type>String</span><span class=punctuation.delimiter>,</span>
</span><span class=line><span class=punctuation.bracket>}</span>
</span><span class=line>
</span><span class=line><span class=punctuation.bracket>#</span><span class=punctuation.bracket>[</span><span class=function.macro>async_trait</span><span class=punctuation.bracket>]</span>
</span><span class=line><span class=keyword>impl</span><span class=punctuation.bracket><</span><span class=type>T</span><span class=punctuation.bracket>></span> <span class=type>FromRequest</span> <span class=keyword>for</span> <span class=type>RequestInfo</span>
</span><span class=line><span class=punctuation.bracket>{</span>
</span><span class=line>    <span class=keyword>type</span> <span class=type>Error</span> <span class=operator>=</span> <span class=type>Infallible</span><span class=punctuation.delimiter>;</span>
</span><span class=line>
</span><span class=line>    <span class=keyword>async</span> <span class=keyword.function>fn</span> <span class=function>extract</span><span class=punctuation.bracket>(</span><span class=parameter>req</span>: <span class=keyword>&</span><span class=keyword>mut</span> <span class=type>Request</span><span class=punctuation.bracket>)</span> <span class=operator>-></span> <span class=type>Result</span><span class=punctuation.bracket><</span><span class=type>Self</span><span class=punctuation.delimiter>,</span> <span class=type>Self</span><span class=punctuation.delimiter>::</span><span class=type>Error</span><span class=punctuation.bracket>></span> <span class=punctuation.bracket>{</span>
</span><span class=line>        <span class=type>Ok</span><span class=punctuation.bracket>(</span><span class=type>RequestInfo</span> <span class=punctuation.bracket>{</span>
</span><span class=line>            <span class=variable>method</span>: <span class=parameter>req</span><span class=punctuation.delimiter>.</span><span class=function>method</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>.</span><span class=function>as_str</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>.</span><span class=function>to_string</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>,</span>
</span><span class=line>            <span class=variable>path</span>: <span class=parameter>req</span><span class=punctuation.delimiter>.</span><span class=function>path</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>.</span><span class=function>to_string</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>,</span>
</span><span class=line>        <span class=punctuation.bracket>}</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=punctuation.bracket>}</span>
</span><span class=line><span class=punctuation.bracket>}</span>
</span><span class=line>
</span><span class=line><span class=keyword>async</span> <span class=keyword.function>fn</span> <span class=function>show_info</span><span class=punctuation.bracket>(</span><span class=keyword>mut</span> <span class=parameter>req</span>: <span class=type>Request</span><span class=punctuation.bracket>)</span> <span class=operator>-></span> <span class=type>Result</span><span class=punctuation.bracket><</span><span class=type>Resposne</span><span class=punctuation.bracket>></span> <span class=punctuation.bracket>{</span>
</span><span class=line>  <span class=keyword>let</span> <span class=variable>req_info</span> <span class=operator>=</span> <span class=parameter>req</span><span class=punctuation.delimiter>.</span><span class=function>extract</span><span class=punctuation.delimiter>::</span><span class=punctuation.bracket><</span><span class=type>RequestInfo</span><span class=punctuation.bracket>></span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>.</span><span class=keyword.return>await</span>?<span class=punctuation.delimiter>;</span>
</span><span class=line>  <span class=type>Ok</span><span class=punctuation.bracket>(</span><span class=type>Resposne</span><span class=punctuation.delimiter>::</span><span class=function>text</span><span class=punctuation.bracket>(</span><span class=function.macro>format</span><span class=function.macro>!</span><span class=punctuation.bracket>(</span><span class=string>"info: {req_info:#?}"</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span>
</span><span class=line><span class=punctuation.bracket>}</span>
</span></code></pre></div></article><nav class="flex-col gap-5 hidden lg:flex"><div class="py-1 text-2 uppercase">本页目录</div><ul class=text-3><li><a class="block py-1 font-normal transition-colors op75 hover:op100"href=#接口定义>接口定义</a></li><li><a class="block py-1 font-normal transition-colors op75 hover:op100"href=#提取函数>提取函数</a></li><li><a class="block py-1 font-normal transition-colors op75 hover:op100"href=#自定义类型>自定义类型</a></li></ul></nav>