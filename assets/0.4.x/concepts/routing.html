<article class=flex-1><h1 id=routing>Routing<a class=anchor href=#routing>#</a></h1><p>Routing is the traffic hub for the entire web application, acting as a backbone for connecting views, controls and data.</p><p>In Vizâ€™s routing system, the <a href=https://github.com/viz-rs/path-tree><code>path-tree</code></a> module is used to store the relationship between <code>path</code> and <code>handler</code>.</p><p>At its core, <a href=https://github.com/viz-rs/path-tree><code>path-tree</code></a> is a <a href=https://en.wikipedia.org/wiki/Trie>trie</a> implementation that provides an efficient search engine and some friendly helper methods.</p><h2 id=structures-and-concepts>Structures and concepts<a class=anchor href=#structures-and-concepts>#</a></h2><ul><li><p><a href=https://docs.rs/viz/0.4.x/viz/struct.Route.html><code>Route</code></a>: basic structure, which is the set of <a href=https://docs.rs/viz/0.4.x/viz/struct.Method.html><code>Method</code></a> - <a href=https://docs.rs/viz/0.4.x/viz/handler/trait.Handler.html><code>Handler</code></a> pairs.</p></li><li><p><a href=https://docs.rs/viz/0.4.x/viz/struct.Resources.html><code>Resources</code></a>: resource structure, which performs CRUD operations by mapping between <code>Action</code> - <a href=https://docs.rs/viz/0.4.x/viz/struct.Method.html><code>Method</code></a>.</p></li><li><p><a href=https://docs.rs/viz/0.4.x/viz/struct.Router.html><code>Router</code></a>: It is the management and maintenance of <a href=https://docs.rs/viz/0.4.x/viz/struct.Route.html><code>Route</code></a>, <a href=https://docs.rs/viz/0.4.x/viz/struct.Resources.html><code>Resources</code></a>, nested routes, middleware.</p></li></ul><h2 id=path-parameters>Path parameters<a class=anchor href=#path-parameters>#</a></h2><p>Thanks to the support provided by <a href=https://github.com/viz-rs/path-tree><code>path-tree</code></a>, it is possible to name parameters in a path by <code>:</code> and <code>?</code> <code>+</code> <code>*</code> sets the type of the parameter.</p><table><thead><tr><th>Pattern</th><th>Rule</th></tr></thead><tbody><tr><td><code>:name</code></td><td>Matches a path piece, excludes <code>/</code></td></tr><tr><td><code>:name?</code></td><td>Matches an optional path piece, excludes <code>/</code></td></tr><tr><td><code>/:name?/</code> <code>/:name?</code></td><td>Matches an optional path segment, excludes <code>/</code>, prefix or suffix should be <code>/</code></td></tr><tr><td><code>+</code> <code>:name+</code></td><td>Matches a path piece, includes <code>/</code></td></tr><tr><td><code>*</code> <code>:name*</code></td><td>Matches an optional path piece, includes <code>/</code></td></tr><tr><td><code>/*</code> <code>/*/</code> <code>/:name*/</code> <code>/:name*</code></td><td>Matches zero or more path segments, prefix or suffix should be <code>/</code></td></tr></tbody></table><p>The parameters can be extracted later with the <a href=https://docs.rs/viz/0.4.x/viz/types/struct.Params.html><code>Params&LTT></code></a> extractor.</p><blockquote><p>Also supported are <strong>continuous parameters</strong> and special characters interspersed between parameters for segmentation.</p></blockquote><h2 id=method-routing>Method routing<a class=anchor href=#method-routing>#</a></h2><p>Add routes using the HTTP method. The following methods are supported:</p><ul><li><a href=https://docs.rs/viz/0.4.x/viz/struct.Router.html#method.get><code>get</code></a></li><li><a href=https://docs.rs/viz/0.4.x/viz/struct.Router.html#method.post><code>post</code></a></li><li><a href=https://docs.rs/viz/0.4.x/viz/struct.Router.html#method.put><code>put</code></a></li><li><a href=https://docs.rs/viz/0.4.x/viz/struct.Router.html#method.delete><code>delete</code></a></li><li><a href=https://docs.rs/viz/0.4.x/viz/struct.Router.html#method.head><code>head</code></a></li><li><a href=https://docs.rs/viz/0.4.x/viz/struct.Router.html#method.options><code>options</code></a></li><li><a href=https://docs.rs/viz/0.4.x/viz/struct.Router.html#method.connect><code>connect</code></a></li><li><a href=https://docs.rs/viz/0.4.x/viz/struct.Router.html#method.path><code>patch</code></a></li><li><a href=https://docs.rs/viz/0.4.x/viz/struct.Router.html#method.trace><code>trace</code></a></li></ul><div class=code><button class="i-lucide-copy transition w-4 h-4 select-none absolute top-4 right-2 op-20 hover:op-80"></button><pre class=language-rust><code><span class=line><span class=keyword>let</span> <span class=variable>routes</span> <span class=operator>=</span> <span class=type>Router</span><span class=punctuation.delimiter>::</span><span class=function>new</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span>
</span><span class=line>  <span class=punctuation.delimiter>.</span><span class=function>get</span><span class=punctuation.bracket>(</span><span class=string>"/about"</span><span class=punctuation.delimiter>,</span> <span class=punctuation.bracket>|</span>_: <span class=type>Request</span><span class=punctuation.bracket>|</span> <span class=keyword>async</span> <span class=punctuation.bracket>{</span> <span class=type>Ok</span><span class=punctuation.bracket>(</span><span class=type>Response</span><span class=punctuation.delimiter>::</span><span class=function>text</span><span class=punctuation.bracket>(</span><span class=string>"About"</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span> <span class=punctuation.bracket>}</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>;</span>
</span></code></pre></div><h2 id=resources-routing>Resources routing<a class=anchor href=#resources-routing>#</a></h2><p>Add routes using the agreed actions. The following actions are supported:</p><table><thead><tr><th>HTTP Method</th><th>Rule</th><th>Action</th><th>Used for</th></tr></thead><tbody><tr><td>GET</td><td><code>/resources</code></td><td><a href=https://docs.rs/viz/0.4.x/viz/struct.Resources.html#method.index><code>index</code></a></td><td>display a list of all resource</td></tr><tr><td>GET</td><td><code>/resources/new</code></td><td><a href=https://docs.rs/viz/0.4.x/viz/struct.Resources.html#method.new><code>new</code></a></td><td>return an HTML form for creating a new resource</td></tr><tr><td>POST</td><td><code>/resources</code></td><td><a href=https://docs.rs/viz/0.4.x/viz/struct.Resources.html#method.create><code>create</code></a></td><td>create a new resource</td></tr><tr><td>GET</td><td><code>/resources/:id</code></td><td><a href=https://docs.rs/viz/0.4.x/viz/struct.Resources.html#method.show><code>show</code></a></td><td>display a specific resource</td></tr><tr><td>GET</td><td><code>/resources/:id/edit</code></td><td><a href=https://docs.rs/viz/0.4.x/viz/struct.Resources.html#method.edit><code>edit</code></a></td><td>return an HTML form for editing a resource</td></tr><tr><td>PUT</td><td><code>/resources/:id</code></td><td><a href=https://docs.rs/viz/0.4.x/viz/struct.Resources.html#method.update><code>update</code></a></td><td>update a specific resource</td></tr><tr><td>PATCH</td><td><code>/resources/:id</code></td><td><a href=https://docs.rs/viz/0.4.x/viz/struct.Resources.html#method.update_with_patch><code>update_with_patch</code></a></td><td>update a specific resource with patch</td></tr><tr><td>DELETE</td><td><code>/resources/:id</code></td><td><a href=https://docs.rs/viz/0.4.x/viz/struct.Resources.html#method.destroy><code>destroy</code></a></td><td>delete a specific resource</td></tr></tbody></table><div class=code><button class="i-lucide-copy transition w-4 h-4 select-none absolute top-4 right-2 op-20 hover:op-80"></button><pre class=language-rust><code><span class=line><span class=keyword>let</span> <span class=variable>resources</span> <span class=operator>=</span> <span class=type>Resources</span><span class=punctuation.delimiter>::</span><span class=function>default</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span>
</span><span class=line>  <span class=punctuation.delimiter>.</span><span class=function>named</span><span class=punctuation.bracket>(</span><span class=string>"post"</span><span class=punctuation.bracket>)</span>
</span><span class=line>  <span class=punctuation.delimiter>.</span><span class=function>index</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>|</span>_: <span class=type>Request</span><span class=punctuation.bracket>|</span> <span class=keyword>async</span> <span class=punctuation.bracket>{</span> <span class=type>Ok</span><span class=punctuation.bracket>(</span><span class=type>Response</span><span class=punctuation.delimiter>::</span><span class=function>text</span><span class=punctuation.bracket>(</span><span class=string>"posts index"</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span> <span class=punctuation.bracket>}</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>;</span>
</span></code></pre></div><h2 id=nested-routing>Nested routing<a class=anchor href=#nested-routing>#</a></h2><p>Nested <a href=https://docs.rs/viz/0.4.x/viz/struct.Route.html><code>Route</code></a>, <a href=https://docs.rs/viz/0.4.x/viz/struct.Resources.html><code>Resources</code></a>, <a href=https://docs.rs/viz/0.4.x/viz/struct.Router.html><code>Router</code></a> into a larger route.</p><p>Here are the three nesting methods:</p><ul><li><p><a href=https://docs.rs/viz/0.4.x/viz/struct.Router.html#method.route><code>route</code></a></p></li><li><p><a href=https://docs.rs/viz/0.4.x/viz/struct.Router.html#method.resources><code>resources</code></a></p></li><li><p><a href=https://docs.rs/viz/0.4.x/viz/struct.Router.html#method.nest><code>nest</code></a></p></li></ul><div class=code><button class="i-lucide-copy transition w-4 h-4 select-none absolute top-4 right-2 op-20 hover:op-80"></button><pre class=language-rust><code><span class=line><span class=keyword>let</span> <span class=variable>search</span> <span class=operator>=</span> <span class=type>Route</span><span class=punctuation.delimiter>::</span><span class=function>new</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>.</span><span class=function>get</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>|</span>_: <span class=type>Request</span><span class=punctuation.bracket>|</span> <span class=keyword>async</span> <span class=punctuation.bracket>{</span> <span class=type>Ok</span><span class=punctuation.bracket>(</span><span class=type>Response</span><span class=punctuation.delimiter>::</span><span class=function>text</span><span class=punctuation.bracket>(</span><span class=string>"search"</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span> <span class=punctuation.bracket>}</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>;</span>
</span><span class=line>
</span><span class=line><span class=keyword>let</span> <span class=variable>orgs</span> <span class=operator>=</span> <span class=type>Resources</span><span class=punctuation.delimiter>::</span><span class=function>default</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=function>index</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>|</span>_: <span class=type>Request</span><span class=punctuation.bracket>|</span> <span class=keyword>async</span> <span class=punctuation.bracket>{</span> <span class=type>Ok</span><span class=punctuation.bracket>(</span><span class=type>Response</span><span class=punctuation.delimiter>::</span><span class=function>text</span><span class=punctuation.bracket>(</span><span class=string>"list posts"</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span> <span class=punctuation.bracket>}</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=function>create</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>|</span>_: <span class=type>Request</span><span class=punctuation.bracket>|</span> <span class=keyword>async</span> <span class=punctuation.bracket>{</span> <span class=type>Ok</span><span class=punctuation.bracket>(</span><span class=type>Response</span><span class=punctuation.delimiter>::</span><span class=function>text</span><span class=punctuation.bracket>(</span><span class=string>"create post"</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span> <span class=punctuation.bracket>}</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=function>show</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>|</span>_: <span class=type>Request</span><span class=punctuation.bracket>|</span> <span class=keyword>async</span> <span class=punctuation.bracket>{</span> <span class=type>Ok</span><span class=punctuation.bracket>(</span><span class=type>Response</span><span class=punctuation.delimiter>::</span><span class=function>text</span><span class=punctuation.bracket>(</span><span class=string>"show post"</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span> <span class=punctuation.bracket>}</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>;</span>
</span><span class=line>
</span><span class=line><span class=keyword>let</span> <span class=variable>settings</span> <span class=operator>=</span> <span class=type>Router</span><span class=punctuation.delimiter>::</span><span class=function>new</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=function>get</span><span class=punctuation.bracket>(</span><span class=string>"/"</span><span class=punctuation.delimiter>,</span> <span class=punctuation.bracket>|</span>_: <span class=type>Request</span><span class=punctuation.bracket>|</span> <span class=keyword>async</span> <span class=punctuation.bracket>{</span> <span class=type>Ok</span><span class=punctuation.bracket>(</span><span class=type>Response</span><span class=punctuation.delimiter>::</span><span class=function>text</span><span class=punctuation.bracket>(</span><span class=string>"settings"</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span> <span class=punctuation.bracket>}</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=function>get</span><span class=punctuation.bracket>(</span><span class=string>"/:page"</span><span class=punctuation.delimiter>,</span> <span class=punctuation.bracket>|</span>_: <span class=type>Request</span><span class=punctuation.bracket>|</span> <span class=keyword>async</span> <span class=punctuation.bracket>{</span>
</span><span class=line>        <span class=type>Ok</span><span class=punctuation.bracket>(</span><span class=type>Response</span><span class=punctuation.delimiter>::</span><span class=function>text</span><span class=punctuation.bracket>(</span><span class=string>"setting page"</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=punctuation.bracket>}</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>;</span>
</span><span class=line>
</span><span class=line><span class=keyword>let</span> <span class=variable>api</span> <span class=operator>=</span> <span class=type>Router</span><span class=punctuation.delimiter>::</span><span class=function>new</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>.</span><span class=function>route</span><span class=punctuation.bracket>(</span><span class=string>"/search"</span><span class=punctuation.delimiter>,</span> <span class=variable>search</span><span class=punctuation.delimiter>.</span><span class=function>clone</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>;</span>
</span><span class=line>
</span><span class=line><span class=keyword>let</span> <span class=variable>app</span> <span class=operator>=</span> <span class=type>Router</span><span class=punctuation.delimiter>::</span><span class=function>new</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=function>get</span><span class=punctuation.bracket>(</span><span class=string>"/"</span><span class=punctuation.delimiter>,</span> <span class=punctuation.bracket>|</span>_: <span class=type>Request</span><span class=punctuation.bracket>|</span> <span class=keyword>async</span> <span class=punctuation.bracket>{</span> <span class=type>Ok</span><span class=punctuation.bracket>(</span><span class=type>Response</span><span class=punctuation.delimiter>::</span><span class=function>text</span><span class=punctuation.bracket>(</span><span class=string>"index"</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span> <span class=punctuation.bracket>}</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=function>route</span><span class=punctuation.bracket>(</span><span class=string>"search"</span><span class=punctuation.delimiter>,</span> <span class=variable>search</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=function>resources</span><span class=punctuation.bracket>(</span><span class=string>":org"</span><span class=punctuation.delimiter>,</span> <span class=variable>orgs</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=function>nest</span><span class=punctuation.bracket>(</span><span class=string>"settings"</span><span class=punctuation.delimiter>,</span> <span class=variable>settings</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=function>nest</span><span class=punctuation.bracket>(</span><span class=string>"api"</span><span class=punctuation.delimiter>,</span> <span class=variable>api</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>;</span>
</span></code></pre></div><h2 id=middleware>Middleware<a class=anchor href=#middleware>#</a></h2><p>We can add a middleware to single <code>handler</code>, all add it to all routes.</p><h3>Handler</h3><p><a href=https://docs.rs/viz/0.4.x/viz/handler/trait.HandlerExt.html><code>HandlerExt</code></a> is an extension trait which provides a number of friendly and easy ways to easily wrap <code>handler</code>.</p><p>Adds the middleware to <code>handler</code> with <a href=https://docs.rs/viz/0.4.x/viz/trait.HandlerExt.html#method.around><code>around</code></a> or <a href=https://docs.rs/viz/0.4.x/viz/trait.HandlerExt.html#method.with><code>with</code></a> methods.</p><ul><li><a href=https://docs.rs/viz/0.4.x/viz/trait.HandlerExt.html#method.around><code>around</code></a></li></ul><div class=code><button class="i-lucide-copy transition w-4 h-4 select-none absolute top-4 right-2 op-20 hover:op-80"></button><pre class=language-rust><code><span class=line><span class=keyword>async</span> <span class=keyword.function>fn</span> <span class=function>middle_fn</span><span class=punctuation.bracket><</span><span class=type>H</span><span class=punctuation.bracket>></span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>(</span><span class=variable>req</span><span class=punctuation.delimiter>,</span> <span class=variable>h</span><span class=punctuation.bracket>)</span>: <span class=type>Next</span><span class=punctuation.bracket><</span><span class=type>Request</span><span class=punctuation.delimiter>,</span> <span class=type>H</span><span class=punctuation.bracket>></span><span class=punctuation.bracket>)</span> <span class=operator>-></span> <span class=type>Result</span><span class=punctuation.bracket><</span><span class=type>Response</span><span class=punctuation.bracket>></span>
</span><span class=line><span class=keyword>where</span>
</span><span class=line>    <span class=type>H</span>: <span class=type>Handler</span><span class=punctuation.bracket><</span><span class=type>Request</span><span class=punctuation.delimiter>,</span> <span class=type>Output</span> <span class=operator>=</span> <span class=type>Result</span><span class=punctuation.bracket><</span><span class=type>Response</span><span class=punctuation.bracket>></span><span class=punctuation.bracket>></span> <span class=operator>+</span> <span class=type>Clone</span><span class=punctuation.delimiter>,</span>
</span><span class=line><span class=punctuation.bracket>{</span>
</span><span class=line>    <span class=variable>h</span><span class=punctuation.delimiter>.</span><span class=function>call</span><span class=punctuation.bracket>(</span><span class=variable>req</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>.</span><span class=keyword.return>await</span>
</span><span class=line><span class=punctuation.bracket>}</span>
</span><span class=line>
</span><span class=line><span class=keyword>let</span> <span class=variable>search</span> <span class=operator>=</span> <span class=punctuation.bracket>(</span><span class=punctuation.bracket>|</span>_: <span class=type>Request</span><span class=punctuation.bracket>|</span> <span class=keyword>async</span> <span class=punctuation.bracket>{</span> <span class=type>Ok</span><span class=punctuation.bracket>(</span><span class=type>Response</span><span class=punctuation.delimiter>::</span><span class=function>text</span><span class=punctuation.bracket>(</span><span class=string>"search"</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span> <span class=punctuation.bracket>}</span><span class=punctuation.bracket>)</span>
</span><span class=line>  <span class=punctuation.delimiter>.</span><span class=function>around</span><span class=punctuation.bracket>(</span><span class=variable>middle_fn</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>;</span>
</span></code></pre></div><ul><li><a href=https://docs.rs/viz/0.4.x/viz/trait.HandlerExt.html#method.with><code>with</code></a></li></ul><div class=code><button class="i-lucide-copy transition w-4 h-4 select-none absolute top-4 right-2 op-20 hover:op-80"></button><pre class=language-rust><code><span class=line><span class=keyword>struct</span> <span class=type>Timeout</span> <span class=punctuation.bracket>{</span>
</span><span class=line>    <span class=variable>delay</span>: <span class=type>Duration</span><span class=punctuation.delimiter>,</span>
</span><span class=line><span class=punctuation.bracket>}</span>
</span><span class=line>
</span><span class=line><span class=keyword>impl</span> <span class=type>Timeout</span> <span class=punctuation.bracket>{</span>
</span><span class=line>    <span class=keyword>pub</span> <span class=keyword.function>fn</span> <span class=function>new</span><span class=punctuation.bracket>(</span><span class=parameter>secs</span>: <span class=type.builtin>u64</span><span class=punctuation.bracket>)</span> <span class=operator>-></span> <span class=type>Self</span> <span class=punctuation.bracket>{</span>
</span><span class=line>        <span class=type>Self</span> <span class=punctuation.bracket>{</span> <span class=variable>delay</span>: <span class=type>Duration</span><span class=punctuation.delimiter>::</span><span class=function>from_secs</span><span class=punctuation.bracket>(</span><span class=parameter>secs</span><span class=punctuation.bracket>)</span> <span class=punctuation.bracket>}</span>
</span><span class=line>    <span class=punctuation.bracket>}</span>
</span><span class=line><span class=punctuation.bracket>}</span>
</span><span class=line>
</span><span class=line><span class=keyword>impl</span><span class=punctuation.bracket><</span><span class=type>H</span>: <span class=type>Clone</span><span class=punctuation.bracket>></span> <span class=type>Transform</span><span class=punctuation.bracket><</span><span class=type>H</span><span class=punctuation.bracket>></span> <span class=keyword>for</span> <span class=type>Timeout</span> <span class=punctuation.bracket>{</span>
</span><span class=line>    <span class=keyword>type</span> <span class=type>Output</span> <span class=operator>=</span> <span class=type>TimeoutMiddleware</span><span class=punctuation.bracket><</span><span class=type>H</span><span class=punctuation.bracket>></span><span class=punctuation.delimiter>;</span>
</span><span class=line>
</span><span class=line>    <span class=keyword.function>fn</span> <span class=function>transform</span><span class=punctuation.bracket>(</span><span class=keyword>&</span><span class=variable.builtin>self</span><span class=punctuation.delimiter>,</span> <span class=parameter>h</span>: <span class=type>H</span><span class=punctuation.bracket>)</span> <span class=operator>-></span> <span class=type>Self</span><span class=punctuation.delimiter>::</span><span class=type>Output</span> <span class=punctuation.bracket>{</span>
</span><span class=line>        <span class=type>TimeoutMiddleware</span><span class=punctuation.bracket>(</span><span class=parameter>h</span><span class=punctuation.delimiter>,</span> <span class=variable.builtin>self</span><span class=punctuation.delimiter>.</span><span class=variable>delay</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=punctuation.bracket>}</span>
</span><span class=line><span class=punctuation.bracket>}</span>
</span><span class=line>
</span><span class=line><span class=punctuation.bracket>#</span><span class=punctuation.bracket>[</span><span class=function.macro>derive</span><span class=punctuation.bracket>(</span><span class=type>Clone</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>]</span>
</span><span class=line><span class=keyword>struct</span> <span class=type>TimeoutMiddleware</span><span class=punctuation.bracket><</span><span class=type>H</span><span class=punctuation.bracket>></span><span class=punctuation.bracket>(</span><span class=type>H</span><span class=punctuation.delimiter>,</span> <span class=type>Duration</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>;</span>
</span><span class=line>
</span><span class=line><span class=punctuation.bracket>#</span><span class=punctuation.bracket>[</span><span class=function.macro>async_trait</span><span class=punctuation.bracket>]</span>
</span><span class=line><span class=keyword>impl</span><span class=punctuation.bracket><</span><span class=type>H</span><span class=punctuation.bracket>></span> <span class=type>Handler</span><span class=punctuation.bracket><</span><span class=type>Request</span><span class=punctuation.bracket>></span> <span class=keyword>for</span> <span class=type>TimeoutMiddleware</span><span class=punctuation.bracket><</span><span class=type>H</span><span class=punctuation.bracket>></span>
</span><span class=line><span class=keyword>where</span>
</span><span class=line>    <span class=type>H</span>: <span class=type>Handler</span><span class=punctuation.bracket><</span><span class=type>Request</span><span class=punctuation.bracket>></span> <span class=operator>+</span> <span class=type>Clone</span><span class=punctuation.delimiter>,</span>
</span><span class=line><span class=punctuation.bracket>{</span>
</span><span class=line>    <span class=keyword>type</span> <span class=type>Output</span> <span class=operator>=</span> <span class=constant>H</span><span class=punctuation.delimiter>::</span><span class=type>Output</span><span class=punctuation.delimiter>;</span>
</span><span class=line>
</span><span class=line>    <span class=keyword>async</span> <span class=keyword.function>fn</span> <span class=function>call</span><span class=punctuation.bracket>(</span><span class=keyword>&</span><span class=variable.builtin>self</span><span class=punctuation.delimiter>,</span> <span class=parameter>req</span>: <span class=type>Request</span><span class=punctuation.bracket>)</span> <span class=operator>-></span> <span class=type>Self</span><span class=punctuation.delimiter>::</span><span class=type>Output</span> <span class=punctuation.bracket>{</span>
</span><span class=line>        <span class=variable.builtin>self</span><span class=punctuation.delimiter>.</span><span class=constant>0</span><span class=punctuation.delimiter>.</span><span class=function>call</span><span class=punctuation.bracket>(</span><span class=parameter>req</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>.</span><span class=keyword.return>await</span>
</span><span class=line>    <span class=punctuation.bracket>}</span>
</span><span class=line><span class=punctuation.bracket>}</span>
</span><span class=line>
</span><span class=line><span class=keyword>let</span> <span class=variable>search</span> <span class=operator>=</span> <span class=punctuation.bracket>(</span><span class=punctuation.bracket>|</span>_: <span class=type>Request</span><span class=punctuation.bracket>|</span> <span class=keyword>async</span> <span class=punctuation.bracket>{</span> <span class=type>Ok</span><span class=punctuation.bracket>(</span><span class=type>Response</span><span class=punctuation.delimiter>::</span><span class=function>text</span><span class=punctuation.bracket>(</span><span class=string>"search"</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span> <span class=punctuation.bracket>}</span><span class=punctuation.bracket>)</span>
</span><span class=line>  <span class=punctuation.delimiter>.</span><span class=function>with</span><span class=punctuation.bracket>(</span><span class=namespace>timeHMS</span><span class=punctuation.delimiter>::</span><span class=function>new</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>;</span>
</span></code></pre></div><h3>All routes</h3><p><a href=https://docs.rs/viz/0.4.x/viz/struct.Route.html><code>Route</code></a>, <a href=https://docs.rs/viz/0.4.x/viz/struct.Resources.html><code>Resources</code></a>, <a href=https://docs.rs/viz/0.4.x/viz/struct.Router.html><code>Router</code></a> all support <code>with</code> and <code>with_handler</code> methods for adding middleware.</p><div class=code><button class="i-lucide-copy transition w-4 h-4 select-none absolute top-4 right-2 op-20 hover:op-80"></button><pre class=language-rust><code><span class=line><span class=keyword>let</span> <span class=variable>routes</span> <span class=operator>=</span> <span class=type>Router</span><span class=punctuation.delimiter>::</span><span class=function>new</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span>
</span><span class=line>  <span class=punctuation.delimiter>.</span><span class=function>get</span><span class=punctuation.bracket>(</span><span class=string>"/"</span><span class=punctuation.delimiter>,</span> <span class=punctuation.bracket>|</span>_: <span class=type>Request</span><span class=punctuation.bracket>|</span> <span class=keyword>async</span> <span class=punctuation.bracket>{</span> <span class=type>Ok</span><span class=punctuation.bracket>(</span><span class=type>Response</span><span class=punctuation.delimiter>::</span><span class=function>text</span><span class=punctuation.bracket>(</span><span class=string>"index"</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span> <span class=punctuation.bracket>}</span>
</span><span class=line>    <span class=comment>// handler middleware</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=function>with</span><span class=punctuation.bracket>(</span><span class=type>Timeout</span><span class=punctuation.delimiter>::</span><span class=function>new</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=function>with_handler</span><span class=punctuation.bracket>(</span><span class=variable>middle_fn</span><span class=punctuation.bracket>)</span>
</span><span class=line>  <span class=punctuation.bracket>)</span>
</span><span class=line>  <span class=punctuation.delimiter>.</span><span class=function>route</span><span class=punctuation.bracket>(</span><span class=string>"/search"</span><span class=punctuation.delimiter>,</span> <span class=type>Route</span><span class=punctuation.delimiter>::</span><span class=function>new</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=function>get</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>|</span>_: <span class=type>Request</span><span class=punctuation.bracket>|</span> <span class=keyword>async</span> <span class=punctuation.bracket>{</span> <span class=type>Ok</span><span class=punctuation.bracket>(</span><span class=type>Response</span><span class=punctuation.delimiter>::</span><span class=function>text</span><span class=punctuation.bracket>(</span><span class=string>"search"</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span> <span class=punctuation.bracket>}</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=comment>// route middle_fn</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=function>with</span><span class=punctuation.bracket>(</span><span class=type>Timeout</span><span class=punctuation.delimiter>::</span><span class=function>new</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=function>with_handler</span><span class=punctuation.bracket>(</span><span class=variable>middle_fn</span><span class=punctuation.bracket>)</span>
</span><span class=line>  <span class=punctuation.bracket>)</span>
</span><span class=line>  <span class=punctuation.delimiter>.</span><span class=function>resources</span><span class=punctuation.bracket>(</span><span class=string>"/posts"</span><span class=punctuation.delimiter>,</span> <span class=type>Resources</span><span class=punctuation.delimiter>::</span><span class=function>default</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=function>named</span><span class=punctuation.bracket>(</span><span class=string>"post"</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=function>index</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>|</span>_: <span class=type>Request</span><span class=punctuation.bracket>|</span> <span class=keyword>async</span> <span class=punctuation.bracket>{</span> <span class=type>Ok</span><span class=punctuation.bracket>(</span><span class=type>Response</span><span class=punctuation.delimiter>::</span><span class=function>text</span><span class=punctuation.bracket>(</span><span class=string>"posts index"</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span> <span class=punctuation.bracket>}</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=comment>// resources middleware</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=function>with</span><span class=punctuation.bracket>(</span><span class=type>Timeout</span><span class=punctuation.delimiter>::</span><span class=function>new</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=function>with_handler</span><span class=punctuation.bracket>(</span><span class=variable>middle_fn</span><span class=punctuation.bracket>)</span>
</span><span class=line>  <span class=punctuation.bracket>)</span>
</span><span class=line>  <span class=punctuation.delimiter>.</span><span class=function>nest</span><span class=punctuation.bracket>(</span><span class=string>"/users"</span><span class=punctuation.delimiter>,</span> <span class=type>Router</span><span class=punctuation.delimiter>::</span><span class=function>new</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=comment>// router middleware</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=function>with</span><span class=punctuation.bracket>(</span><span class=type>Timeout</span><span class=punctuation.delimiter>::</span><span class=function>new</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=function>with_handler</span><span class=punctuation.bracket>(</span><span class=variable>middle_fn</span><span class=punctuation.bracket>)</span>
</span><span class=line>  <span class=punctuation.bracket>)</span>
</span><span class=line>  <span class=comment>// router middleware</span>
</span><span class=line>  <span class=punctuation.delimiter>.</span><span class=function>with</span><span class=punctuation.bracket>(</span><span class=type>Timeout</span><span class=punctuation.delimiter>::</span><span class=function>new</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span>
</span><span class=line>  <span class=punctuation.delimiter>.</span><span class=function>with_handler</span><span class=punctuation.bracket>(</span><span class=variable>middle_fn</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>;</span>
</span></code></pre></div><h2 id=examples>Examples<a class=anchor href=#examples>#</a></h2><ul><li><a href=https://github.com/viz-rs/viz/tree/0.4.x/examples/routing/todos>Todos</a></li></ul></article><nav class="flex-col gap-5 hidden lg:flex"><div class="py-1 text-2 uppercase">On this page</div><ul class=text-3><li><a class="block py-1 font-normal transition-colors op75 hover:op100"href=#structures-and-concepts>Structures and concepts</a></li><li><a class="block py-1 font-normal transition-colors op75 hover:op100"href=#path-parameters>Path parameters</a></li><li><a class="block py-1 font-normal transition-colors op75 hover:op100"href=#method-routing>Method routing</a></li><li><a class="block py-1 font-normal transition-colors op75 hover:op100"href=#resources-routing>Resources routing</a></li><li><a class="block py-1 font-normal transition-colors op75 hover:op100"href=#nested-routing>Nested routing</a></li><li><a class="block py-1 font-normal transition-colors op75 hover:op100"href=#middleware>Middleware</a></li><li><a class="block py-1 font-normal transition-colors op75 hover:op100"href=#examples>Examples</a></li></ul></nav>