<article class=flex-1><h1 id=ä¸­é—´ä»¶>ä¸­é—´ä»¶<a class=anchor href=#ä¸­é—´ä»¶>#</a></h1><p>åœ¨ Viz ä¸­ï¼Œä¸­é—´ä»¶æ¨¡å‹è·Ÿè¯·æ±‚å¤„ç†å…±ç”¨ä¸€ä¸ªç‰¹å¾ <a href=https://docs.rs/viz/latest/viz/trait.Handler.html><code>Handler</code></a>ï¼Œå³ç®€åŒ–äº†æ¨¡å‹ï¼Œä¹Ÿé™ä½äº†å¼€å‘éš¾åº¦ã€‚</p><h2 id=åŸºæœ¬å‡½æ•°>åŸºæœ¬å‡½æ•°<a class=anchor href=#åŸºæœ¬å‡½æ•°>#</a></h2><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªæœ€åŸºæœ¬çš„ä¸­é—´ä»¶å‡½æ•°ï¼š</p><div class=code><button class="i-lucide-copy transition w-4 h-4 select-none absolute top-4 right-2 op-20 hover:op-80"></button><pre class=language-rust><code><span class=line><span class=keyword>async</span> <span class=keyword.function>fn</span> <span class=function>middleware</span><span class=punctuation.bracket><</span><span class=type>H</span><span class=punctuation.bracket>></span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>(</span><span class=variable>req</span><span class=punctuation.delimiter>,</span> <span class=variable>handler</span><span class=punctuation.bracket>)</span>: <span class=type>Next</span><span class=punctuation.bracket><</span><span class=type>Request</span><span class=punctuation.delimiter>,</span> <span class=type>H</span><span class=punctuation.bracket>></span><span class=punctuation.bracket>)</span> <span class=operator>-></span> <span class=type>Result</span><span class=punctuation.bracket><</span><span class=type>Response</span><span class=punctuation.bracket>></span>
</span><span class=line><span class=keyword>where</span>
</span><span class=line>    <span class=type>H</span>: <span class=type>Handler</span><span class=punctuation.bracket><</span><span class=type>Request</span><span class=punctuation.delimiter>,</span> <span class=type>Output</span> <span class=operator>=</span> <span class=type>Result</span><span class=punctuation.bracket><</span><span class=type>Response</span><span class=punctuation.bracket>></span><span class=punctuation.bracket>></span> <span class=operator>+</span> <span class=type>Clone</span><span class=punctuation.delimiter>,</span>
</span><span class=line><span class=punctuation.bracket>{</span>
</span><span class=line>    <span class=comment>// åœ¨æ‰§è¡Œ handler ä¹‹å‰ï¼Œå¯ä»¥å¯¹ request åšäº›å¤„ç†</span>
</span><span class=line>    <span class=keyword>let</span> <span class=variable>resp</span> <span class=operator>=</span> <span class=variable>handler</span><span class=punctuation.delimiter>.</span><span class=function>call</span><span class=punctuation.bracket>(</span><span class=variable>req</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>.</span><span class=keyword.return>await</span><span class=punctuation.delimiter>;</span>
</span><span class=line>    <span class=comment>// åœ¨æ‰§è¡Œ handler ä¹‹åï¼Œå¯ä»¥å¯¹ response åšäº›å¤„ç†</span>
</span><span class=line>    <span class=variable>resp</span>
</span><span class=line><span class=punctuation.bracket>}</span>
</span></code></pre></div><p>å…¶ä¸­è¾“å…¥å‚æ•°æ˜¯ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„å…ƒç»„ç±»å‹ <code><a href=https://docs.rs/viz/latest/viz/type.Next.html>Next&LTRequest, H></a></code>ï¼š</p><div class=code><button class="i-lucide-copy transition w-4 h-4 select-none absolute top-4 right-2 op-20 hover:op-80"></button><pre class=language-rust><code><span class=line><span class=keyword>pub</span> <span class=keyword>type</span> <span class=type>Next</span><span class=punctuation.bracket><</span><span class=type>I</span><span class=punctuation.delimiter>,</span> <span class=type>H</span><span class=punctuation.bracket>></span> <span class=operator>=</span> <span class=punctuation.bracket>(</span><span class=type>I</span><span class=punctuation.delimiter>,</span> <span class=type>H</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>;</span>
</span></code></pre></div><p>ç„¶åè¾“å‡ºç»“æœ <code>Result<<a href=https://docs.rs/viz/latest/viz/type.Response.html>Response</a>></code> è¿›è¡Œè¿”å›ã€‚</p><h2 id=è‡ªå®šä¹‰ç±»å‹>è‡ªå®šä¹‰ç±»å‹<a class=anchor href=#è‡ªå®šä¹‰ç±»å‹>#</a></h2><p>å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡å®šä¹‰æ–°ç±»å‹æ¥æ„é€ ä¸­é—´ä»¶ã€‚</p><div class=code><button class="i-lucide-copy transition w-4 h-4 select-none absolute top-4 right-2 op-20 hover:op-80"></button><pre class=language-rust><code><span class=line><span class=punctuation.bracket>#</span><span class=punctuation.bracket>[</span><span class=function.macro>derive</span><span class=punctuation.bracket>(</span><span class=type>Clone</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>]</span>
</span><span class=line><span class=keyword>struct</span> <span class=type>MyMiddleware</span><span class=punctuation.delimiter>;</span>
</span><span class=line>
</span><span class=line><span class=punctuation.bracket>#</span><span class=punctuation.bracket>[</span><span class=function.macro>async_trait</span><span class=punctuation.bracket>]</span>
</span><span class=line><span class=keyword>impl</span><span class=punctuation.bracket><</span><span class=type>H</span><span class=punctuation.bracket>></span> <span class=type>Handler</span><span class=punctuation.bracket><</span><span class=type>Next</span><span class=punctuation.bracket><</span><span class=type>Request</span><span class=punctuation.delimiter>,</span> <span class=type>H</span><span class=punctuation.bracket>></span><span class=punctuation.bracket>></span> <span class=keyword>for</span> <span class=type>MyMiddleware</span>
</span><span class=line><span class=keyword>where</span>
</span><span class=line>    <span class=type>H</span>: <span class=type>Handler</span><span class=punctuation.bracket><</span><span class=type>Request</span><span class=punctuation.delimiter>,</span> <span class=type>Output</span> <span class=operator>=</span> <span class=type>Result</span><span class=punctuation.bracket><</span><span class=type>Response</span><span class=punctuation.bracket>></span><span class=punctuation.bracket>></span> <span class=operator>+</span> <span class=type>Clone</span><span class=punctuation.delimiter>,</span>
</span><span class=line><span class=punctuation.bracket>{</span>
</span><span class=line>    <span class=keyword>type</span> <span class=type>Output</span> <span class=operator>=</span> <span class=constant>H</span><span class=punctuation.delimiter>::</span><span class=type>Output</span><span class=punctuation.delimiter>;</span>
</span><span class=line>
</span><span class=line>    <span class=keyword>async</span> <span class=keyword.function>fn</span> <span class=function>call</span><span class=punctuation.bracket>(</span><span class=keyword>&</span><span class=variable.builtin>self</span><span class=punctuation.delimiter>,</span> <span class=punctuation.bracket>(</span><span class=variable>req</span><span class=punctuation.delimiter>,</span> <span class=variable>handler</span><span class=punctuation.bracket>)</span>: <span class=type>Next</span><span class=punctuation.bracket><</span><span class=type>Request</span><span class=punctuation.delimiter>,</span> <span class=type>H</span><span class=punctuation.bracket>></span><span class=punctuation.bracket>)</span> <span class=operator>-></span> <span class=type>Self</span><span class=punctuation.delimiter>::</span><span class=type>Output</span> <span class=punctuation.bracket>{</span>
</span><span class=line>        <span class=comment>// åœ¨æ‰§è¡Œ handler ä¹‹å‰ï¼Œå¯ä»¥å¯¹ request åšäº›å¤„ç†</span>
</span><span class=line>        <span class=keyword>let</span> <span class=variable>resp</span> <span class=operator>=</span> <span class=variable>handler</span><span class=punctuation.delimiter>.</span><span class=function>call</span><span class=punctuation.bracket>(</span><span class=variable>req</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>.</span><span class=keyword.return>await</span><span class=punctuation.delimiter>;</span>
</span><span class=line>        <span class=comment>// åœ¨æ‰§è¡Œ handler ä¹‹åï¼Œå¯ä»¥å¯¹ response åšäº›å¤„ç†</span>
</span><span class=line>        <span class=variable>resp</span>
</span><span class=line>    <span class=punctuation.bracket>}</span>
</span><span class=line><span class=punctuation.bracket>}</span>
</span></code></pre></div><blockquote><p>å¯ä»¥æ‰“å¼€ ã€Œè¯·æ±‚å¤„ç†ã€è¿›è¡Œå¯¹æ¯”ï¼Œå®ƒä»¬éå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯å‚æ•°ä¸åŒè€Œå·²ï¼Œ<code>Handler</code> èŠ‚çœäº†æˆ‘ä»¬å¾ˆå¤šè„‘åŠ›ã€‚ğŸ¦€ï¸</p></blockquote></article><nav class="flex-col gap-5 hidden lg:flex"><div class="py-1 text-2 uppercase">æœ¬é¡µç›®å½•</div><ul class=text-3><li><a class="block py-1 font-normal transition-colors op75 hover:op100"href=#åŸºæœ¬å‡½æ•°>åŸºæœ¬å‡½æ•°</a></li><li><a class="block py-1 font-normal transition-colors op75 hover:op100"href=#è‡ªå®šä¹‰ç±»å‹>è‡ªå®šä¹‰ç±»å‹</a></li></ul></nav>