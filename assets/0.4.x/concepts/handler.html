<article class=flex-1><h1 id=handler>Handler<a class=anchor href=#handler>#</a></h1><h2 id=basic-trait>Basic Trait<a class=anchor href=#basic-trait>#</a></h2><p>In Viz, we defined a basic trait <a href=https://docs.rs/viz/0.4.x/viz/trait.Handler.html><code>Handler</code></a> to handle the request, it has a very simple interface, with only one input and one output. It has been implemented internally for asynchronous functions, so asynchronous processing can be easily constructed.</p><p>Here is <a href=https://docs.rs/viz/0.4.x/viz/trait.Handler.html><code>Handler</code></a>â€™s definition:</p><div class=code><button class="i-lucide-copy transition w-4 h-4 select-none absolute top-4 right-2 op-20 hover:op-80"></button><pre class=language-rust><code><span class=line><span class=punctuation.bracket>#</span><span class=punctuation.bracket>[</span><span class=function.macro>async_trait</span><span class=punctuation.bracket>]</span>
</span><span class=line><span class=keyword>pub</span> <span class=keyword>trait</span> <span class=type>Handler</span><span class=punctuation.bracket><</span><span class=type>Input</span><span class=punctuation.bracket>></span>: <span class=namespace>dyn_clone</span><span class=punctuation.delimiter>::</span><span class=type>DynClone</span> <span class=operator>+</span> <span class=type>Send</span> <span class=operator>+</span> <span class=type>Sync</span> <span class=operator>+</span> <span class=label>'</span><span class=label>static</span> <span class=punctuation.bracket>{</span>
</span><span class=line>    <span class=keyword>type</span> <span class=type>Output</span><span class=punctuation.delimiter>;</span>
</span><span class=line>
</span><span class=line>    <span class=punctuation.bracket>#</span><span class=punctuation.bracket>[</span><span class=function.macro>must_use</span><span class=punctuation.bracket>]</span>
</span><span class=line>    <span class=keyword>async</span> <span class=keyword.function>fn</span> <span class=function>call</span><span class=punctuation.bracket>(</span><span class=keyword>&</span><span class=variable.builtin>self</span><span class=punctuation.delimiter>,</span> <span class=parameter>input</span>: <span class=type>Input</span><span class=punctuation.bracket>)</span> <span class=operator>-></span> <span class=type>Self</span><span class=punctuation.delimiter>::</span><span class=type>Output</span><span class=punctuation.delimiter>;</span>
</span><span class=line><span class=punctuation.bracket>}</span>
</span></code></pre></div><h3>A simple asynchronous processing function</h3><p>Where input is <a href=https://docs.rs/viz/0.4.x/viz/type.Request.html><code>Request</code></a>, output is <code>Result<<a href=https://docs.rs/viz/0.4.x/viz/type.Response.html>Response</a>></code>.</p><div class=code><button class="i-lucide-copy transition w-4 h-4 select-none absolute top-4 right-2 op-20 hover:op-80"></button><pre class=language-rust><code><span class=line><span class=keyword>async</span> <span class=keyword.function>fn</span> <span class=function>index</span><span class=punctuation.bracket>(</span>_: <span class=type>Request</span><span class=punctuation.bracket>)</span> <span class=operator>-></span> <span class=type>Result</span><span class=punctuation.bracket><</span><span class=type>Response</span><span class=punctuation.bracket>></span> <span class=punctuation.bracket>{</span>
</span><span class=line>    <span class=type>Ok</span><span class=punctuation.bracket>(</span><span class=type>Response</span><span class=punctuation.delimiter>::</span><span class=function>text</span><span class=punctuation.bracket>(</span><span class=string>"Hello, World!"</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span>
</span><span class=line><span class=punctuation.bracket>}</span>
</span></code></pre></div><h3>Custom Types</h3><p>Construct request processing by implementing the <a href=https://docs.rs/viz/0.4.x/viz/trait.Handler.html><code>Handler</code></a> trait with a custom type.</p><div class=code><button class="i-lucide-copy transition w-4 h-4 select-none absolute top-4 right-2 op-20 hover:op-80"></button><pre class=language-rust><code><span class=line><span class=punctuation.bracket>#</span><span class=punctuation.bracket>[</span><span class=function.macro>derive</span><span class=punctuation.bracket>(</span><span class=type>Clone</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>]</span>
</span><span class=line><span class=keyword>struct</span> <span class=type>MyHandler</span> <span class=punctuation.bracket>{</span>
</span><span class=line>  <span class=variable>count</span>: <span class=type>Arc</span><span class=punctuation.bracket><</span><span class=type>AtomicUsize</span><span class=punctuation.bracket>></span><span class=punctuation.delimiter>,</span>
</span><span class=line><span class=punctuation.bracket>}</span>
</span><span class=line>
</span><span class=line><span class=punctuation.bracket>#</span><span class=punctuation.bracket>[</span><span class=function.macro>async_trait</span><span class=punctuation.bracket>]</span>
</span><span class=line><span class=keyword>impl</span> <span class=type>Handler</span><span class=punctuation.bracket><</span><span class=type>Request</span><span class=punctuation.bracket>></span> <span class=keyword>for</span> <span class=type>MyHandler</span> <span class=punctuation.bracket>{</span>
</span><span class=line>    <span class=keyword>type</span> <span class=type>Output</span> <span class=operator>=</span> <span class=type>Result</span><span class=punctuation.bracket><</span><span class=type>Response</span><span class=punctuation.bracket>></span><span class=punctuation.delimiter>;</span>
</span><span class=line>
</span><span class=line>    <span class=keyword>async</span> <span class=keyword.function>fn</span> <span class=function>call</span><span class=punctuation.bracket>(</span><span class=keyword>&</span><span class=variable.builtin>self</span><span class=punctuation.delimiter>,</span> <span class=parameter>req</span>: <span class=type>Request</span><span class=punctuation.bracket>)</span> <span class=operator>-></span> <span class=type>Self</span><span class=punctuation.delimiter>::</span><span class=type>Output</span> <span class=punctuation.bracket>{</span>
</span><span class=line>        <span class=keyword>let</span> <span class=variable>path</span> <span class=operator>=</span> <span class=parameter>req</span><span class=punctuation.delimiter>.</span><span class=function>path</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>.</span><span class=function>clone</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>;</span>
</span><span class=line>        <span class=keyword>let</span> <span class=variable>method</span> <span class=operator>=</span> <span class=parameter>req</span><span class=punctuation.delimiter>.</span><span class=function>method</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>.</span><span class=function>clone</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>;</span>
</span><span class=line>        <span class=keyword>let</span> <span class=variable>count</span> <span class=operator>=</span> <span class=variable.builtin>self</span><span class=punctuation.delimiter>.</span><span class=variable>count</span><span class=punctuation.delimiter>.</span><span class=function>fetch_add</span><span class=punctuation.bracket>(</span><span class=constant>1</span><span class=punctuation.delimiter>,</span> <span class=type>Ordering</span><span class=punctuation.delimiter>::</span><span class=type>SeqCst</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>;</span>
</span><span class=line>        <span class=type>Ok</span><span class=punctuation.bracket>(</span><span class=function.macro>format</span><span class=function.macro>!</span><span class=punctuation.bracket>(</span><span class=string>"method = {method}, path = {path}, count = {count}"</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>.</span><span class=function>into_response</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=punctuation.bracket>}</span>
</span><span class=line><span class=punctuation.bracket>}</span>
</span></code></pre></div><h2 id=extension-trait>Extension Trait<a class=anchor href=#extension-trait>#</a></h2><p>An extension trait <a href=https://docs.rs/viz/0.4.x/viz/trait.HandlerExt.html><code>HandlerExt</code></a> for <a href=https://docs.rs/viz/0.4.x/viz/trait.Handler.html><code>Handler</code></a>, which provides adapters for chaining and composing handlers.</p><p>The following is a list of extension methods:</p><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody><tr><td><a href=https://docs.rs/viz/0.4.x/viz/trait.HandlerExt.html#method.boxed><code>boxed</code></a></td><td>Wrap the <code>handler</code> in a box</td></tr><tr><td><a href=https://docs.rs/viz/0.4.x/viz/trait.HandlerExt.html#method.before><code>before</code></a></td><td>Process the input before executing the <code>handler</code></td></tr><tr><td><a href=https://docs.rs/viz/0.4.x/viz/trait.HandlerExt.html#method.after><code>after</code></a></td><td>Process the output after the execution of <code>handler</code></td></tr><tr><td><a href=https://docs.rs/viz/0.4.x/viz/trait.HandlerExt.html#method.around><code>around</code></a></td><td>Customize before and after processing when executing <code>handler</code></td></tr><tr><td><a href=https://docs.rs/viz/0.4.x/viz/trait.HandlerExt.html#method.map><code>map</code></a></td><td>After executing <code>handler</code>, the correct result is processed</td></tr><tr><td><a href=https://docs.rs/viz/0.4.x/viz/trait.HandlerExt.html#method.map_into_response><code>map_into_response</code></a></td><td>After executing <code>handler</code>, convert the correct result to <a href=https://docs.rs/viz/0.4.x/viz/type.Response.html><code>Response</code></a></td></tr><tr><td><a href=https://docs.rs/viz/0.4.x/viz/trait.HandlerExt.html#method.and_then><code>and_then</code></a></td><td>After executing <code>handler</code>, add an action to process the correct result</td></tr><tr><td><a href=https://docs.rs/viz/0.4.x/viz/trait.HandlerExt.html#method.map_err><code>map_err</code></a></td><td>After executing <code>handler</code>, the error result is processed</td></tr><tr><td><a href=https://docs.rs/viz/0.4.x/viz/trait.HandlerExt.html#method.or_err><code>or_err</code></a></td><td>After executing <code>handler</code>, add an action to handle the error result</td></tr><tr><td><a href=https://docs.rs/viz/0.4.x/viz/trait.HandlerExt.html#method.catch_error><code>catch_error</code></a></td><td>When executing <code>handler</code>, error messages are caught and processed</td></tr><tr><td><a href=https://docs.rs/viz/0.4.x/viz/trait.HandlerExt.html#method.catch_unwind><code>catch_unwind</code></a></td><td>Catch error messages and block <code>panic</code> when executing <code>handler</code></td></tr><tr><td><a href=https://docs.rs/viz/0.4.x/viz/trait.HandlerExt.html#method.with><code>with</code></a></td><td>Wrap <code>handler</code> with a type that implements the <a href=https://docs.rs/viz/0.4.x/viz/trait.Transform.html><code>Transform</code></a> trait</td></tr><tr><td><a href=https://docs.rs/viz/0.4.x/viz/trait.HandlerExt.html#method.with_fn><code>with_fn</code></a></td><td>Add an action to process or convert <code>handler</code></td></tr></tbody></table><blockquote><p>Here is a brief introduction, which will be expanded in detail in the routing section.</p></blockquote></article><nav class="flex-col gap-5 hidden lg:flex"><div class="py-1 text-2 uppercase">On this page</div><ul class=text-3><li><a class="block py-1 font-normal transition-colors op75 hover:op100"href=#basic-trait>Basic Trait</a></li><li><a class="block py-1 font-normal transition-colors op75 hover:op100"href=#extension-trait>Extension Trait</a></li></ul></nav>