<article class=flex-1><h1 id=request-handling>Request Handling<a class=anchor href=#request-handling>#</a></h1><p>There are some handy <code>handler</code> built into Viz, and you can use them by turning on the corresponding features.</p><table><thead><tr><th>Feature</th><th>Description</th></tr></thead><tbody><tr><td><a href=https://docs.rs/viz/0.4.x/viz/handlers/serve/index.html><code>serve</code></a></td><td>Serve static file and directory</td></tr><tr><td><a href=https://docs.rs/viz/0.4.x/viz/handlers/embed/index.html><code>embed</code></a></td><td>Embedded resource files</td></tr><tr><td><a href=https://docs.rs/viz/0.4.x/viz/handlers/prometheus/index.html><code>prometheus</code></a></td><td>OpenTelemetry Prometheus Exporter</td></tr></tbody></table><h2 id=serve>serve<a class=anchor href=#serve>#</a></h2><p>Flexible servicing of individual files or directories is possible.</p><ul><li><p><a href=https://docs.rs/viz/0.4.x/viz/handlers/serve/struct.File.html><code>serve::File</code></a>：Serve specific file</p></li><li><p><a href=https://docs.rs/viz/0.4.x/viz/handlers/serve/struct.Dir.html><code>serve::Dir</code></a>：Serve specific directory</p></li></ul><p>Complete <a href=https://github.com/viz-rs/viz/tree/0.4.x/examples/static-files/serve>example</a>.</p><h2 id=embed>embed<a class=anchor href=#embed>#</a></h2><p>Resource files can be packaged into executable files to generate a single file for easy management of deployment.</p><ul><li><p><a href=https://docs.rs/viz/0.4.x/viz/handlers/embed/struct.File.html><code>embed::File</code></a>：Embed specific file</p></li><li><p><a href=https://docs.rs/viz/0.4.x/viz/handlers/embed/struct.Dir.html><code>embed::Dir</code></a>：Embed specific directory</p></li></ul><p>Complete <a href=https://github.com/viz-rs/viz/tree/0.4.x/examples/static-files/embed>example</a>.</p><h2 id=prometheus>prometheus<a class=anchor href=#prometheus>#</a></h2><p>Current <code>metrics</code> information can be exported for collection by <code>Prometheus</code>.</p><div class=code><button class="i-lucide-copy transition w-4 h-4 select-none absolute top-4 right-2 op-20 hover:op-80"></button><pre class=language-rust><code><span class=line><span class=keyword>use</span> <span class=namespace>opentelemetry</span><span class=punctuation.delimiter>::</span><span class=punctuation.bracket>{</span>
</span><span class=line>    <span class=namespace>global</span><span class=punctuation.delimiter>,</span>
</span><span class=line>    <span class=namespace>sdk</span><span class=punctuation.delimiter>::</span><span class=punctuation.bracket>{</span>
</span><span class=line>        <span class=namespace>export</span><span class=punctuation.delimiter>::</span><span class=namespace>metrics</span><span class=punctuation.delimiter>::</span><span class=namespace>aggregation</span><span class=punctuation.delimiter>,</span>
</span><span class=line>        <span class=namespace>metrics</span><span class=punctuation.delimiter>::</span><span class=punctuation.bracket>{</span><span class=namespace>controllers</span><span class=punctuation.delimiter>,</span> <span class=namespace>processors</span><span class=punctuation.delimiter>,</span> <span class=namespace>selectors</span><span class=punctuation.bracket>}</span><span class=punctuation.delimiter>,</span>
</span><span class=line>    <span class=punctuation.bracket>}</span><span class=punctuation.delimiter>,</span>
</span><span class=line><span class=punctuation.bracket>}</span><span class=punctuation.delimiter>;</span>
</span><span class=line>
</span><span class=line><span class=keyword>use</span> <span class=namespace>viz</span><span class=punctuation.delimiter>::</span><span class=punctuation.bracket>{</span>
</span><span class=line>    <span class=namespace>handlers</span><span class=punctuation.delimiter>::</span><span class=namespace>prometheus</span><span class=punctuation.delimiter>::</span><span class=punctuation.bracket>{</span><span class=type>ExporterBuilder</span><span class=punctuation.delimiter>,</span> <span class=type>Prometheus</span><span class=punctuation.bracket>}</span><span class=punctuation.delimiter>,</span>
</span><span class=line><span class=punctuation.bracket>}</span><span class=punctuation.delimiter>;</span>
</span><span class=line>
</span><span class=line><span class=keyword>let</span> <span class=variable>exporter</span> <span class=operator>=</span> <span class=punctuation.bracket>{</span>
</span><span class=line>    <span class=keyword>let</span> <span class=variable>controller</span> <span class=operator>=</span> <span class=namespace>controllers</span><span class=punctuation.delimiter>::</span><span class=function>basic</span><span class=punctuation.bracket>(</span>
</span><span class=line>        <span class=namespace>processors</span><span class=punctuation.delimiter>::</span><span class=function>factory</span><span class=punctuation.bracket>(</span>
</span><span class=line>            <span class=namespace>selectors</span><span class=punctuation.delimiter>::</span><span class=namespace>simple</span><span class=punctuation.delimiter>::</span><span class=function>histogram</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>[</span><span class=constant>1.0</span><span class=punctuation.delimiter>,</span> <span class=constant>2.0</span><span class=punctuation.delimiter>,</span> <span class=constant>5.0</span><span class=punctuation.delimiter>,</span> <span class=constant>10.0</span><span class=punctuation.delimiter>,</span> <span class=constant>20.0</span><span class=punctuation.delimiter>,</span> <span class=constant>50.0</span><span class=punctuation.bracket>]</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>,</span>
</span><span class=line>            <span class=namespace>aggregation</span><span class=punctuation.delimiter>::</span><span class=function>cumulative_temporality_selector</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>,</span>
</span><span class=line>        <span class=punctuation.bracket>)</span>
</span><span class=line>        <span class=punctuation.delimiter>.</span><span class=function>with_memory</span><span class=punctuation.bracket>(</span><span class=constant.builtin>true</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>,</span>
</span><span class=line>    <span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=function>build</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>;</span>
</span><span class=line>    <span class=type>ExporterBuilder</span><span class=punctuation.delimiter>::</span><span class=function>new</span><span class=punctuation.bracket>(</span><span class=variable>controller</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>.</span><span class=function>init</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span>
</span><span class=line><span class=punctuation.bracket>}</span><span class=punctuation.delimiter>;</span>
</span><span class=line>
</span><span class=line><span class=keyword>let</span> <span class=variable>handler</span> <span class=operator>=</span> <span class=type>Prometheus</span><span class=punctuation.delimiter>::</span><span class=function>new</span><span class=punctuation.bracket>(</span><span class=variable>exporter</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>;</span>
</span><span class=line>
</span><span class=line><span class=keyword>let</span> <span class=variable>app</span> <span class=operator>=</span> <span class=type>Router</span><span class=punctuation.delimiter>::</span><span class=function>new</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=function>get</span><span class=punctuation.bracket>(</span><span class=string>"/metrics"</span><span class=punctuation.delimiter>,</span> <span class=variable>handler</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>;</span>
</span></code></pre></div><p>Complete <a href=https://github.com/viz-rs/viz/tree/0.4.x/examples/otel/metrics>example</a>.</p><div class=page-nav><a class=prev-link href=/docs/0.4.x/concepts/error-handling><span class=desc><i class="block i-lucide-chevron-left w-3 h-3"></i> Previous</span><span class=title>Error Handling</span></a><a class=next-link href=/docs/0.4.x/built-ins/middleware><span class=desc>Next <i class="block i-lucide-chevron-right w-3 h-3"></i></span><span class=title>Middleware</span></a></div></article><nav class="flex-col gap-5 hidden lg:flex"><div class="py-1 text-2 uppercase">On this page</div><ul class=text-3><li><a class="block py-1 font-normal transition-colors op75 hover:op100"href=#serve>serve</a></li><li><a class="block py-1 font-normal transition-colors op75 hover:op100"href=#embed>embed</a></li><li><a class="block py-1 font-normal transition-colors op75 hover:op100"href=#prometheus>prometheus</a></li></ul></nav>