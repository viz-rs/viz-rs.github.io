<article class=flex-1><h1 id=服务>服务<a class=anchor href=#服务>#</a></h1><p>对 <a href=https://docs.rs/viz/latest/viz/struct.Server.html><code>Server</code></a> 进行配置，可以快速地启动一个服务。</p><p>然后把 <a href=https://docs.rs/viz/latest/viz/struct.Router.html><code>Router</code></a> 实例转换成实现 <a href=https://docs.rs/hyper/0.14/hyper/service/index.html><code>Service</code></a> 特性的 <a href=https://docs.rs/viz/latest/viz/struct.ServiceMaker.html><code>ServiceMaker</code></a> 实例。</p><div class=code><button class="i-lucide-copy transition w-4 h-4 select-none absolute top-4 right-2 op-20 hover:op-80"></button><pre class=language-rust><code><span class=line><span class=keyword>async</span> <span class=keyword.function>fn</span> <span class=function>index</span><span class=punctuation.bracket>(</span>_: <span class=type>Request</span><span class=punctuation.bracket>)</span> <span class=operator>-></span> <span class=type>Result</span><span class=punctuation.bracket><</span><span class=keyword>&</span><span class=label>'</span><span class=label>static</span> <span class=type.builtin>str</span><span class=punctuation.bracket>></span> <span class=punctuation.bracket>{</span>
</span><span class=line>    <span class=type>Ok</span><span class=punctuation.bracket>(</span><span class=string>"Hello, World!"</span><span class=punctuation.bracket>)</span>
</span><span class=line><span class=punctuation.bracket>}</span>
</span><span class=line>
</span><span class=line><span class=keyword>let</span> <span class=variable>addr</span> <span class=operator>=</span> <span class=type>SocketAddr</span><span class=punctuation.delimiter>::</span><span class=function>from</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>[</span><span class=constant>127</span><span class=punctuation.delimiter>,</span> <span class=constant>0</span><span class=punctuation.delimiter>,</span> <span class=constant>0</span><span class=punctuation.delimiter>,</span> <span class=constant>1</span><span class=punctuation.bracket>]</span><span class=punctuation.delimiter>,</span> <span class=constant>3000</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>;</span>
</span><span class=line>
</span><span class=line><span class=comment>// 创建 Router 实例</span>
</span><span class=line><span class=keyword>let</span> <span class=variable>app</span> <span class=operator>=</span> <span class=type>Router</span><span class=punctuation.delimiter>::</span><span class=function>new</span><span class=punctuation.bracket>(</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>.</span><span class=function>get</span><span class=punctuation.bracket>(</span><span class=string>"/"</span><span class=punctuation.delimiter>,</span> <span class=variable>index</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>;</span>
</span><span class=line>
</span><span class=line><span class=comment>// 创建 Server 实例，绑定端口</span>
</span><span class=line><span class=keyword>if</span> <span class=keyword>let</span> <span class=constructor>Err</span><span class=punctuation.bracket>(</span><span class=variable>err</span><span class=punctuation.bracket>)</span> <span class=operator>=</span> <span class=type>Server</span><span class=punctuation.delimiter>::</span><span class=function>bind</span><span class=punctuation.bracket>(</span><span class=operator>&</span><span class=variable>addr</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=comment>// 转换成 Service 实例</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=function>serve</span><span class=punctuation.bracket>(</span><span class=type>ServiceMaker</span><span class=punctuation.delimiter>::</span><span class=function>from</span><span class=punctuation.bracket>(</span><span class=variable>app</span><span class=punctuation.bracket>)</span><span class=punctuation.bracket>)</span>
</span><span class=line>    <span class=punctuation.delimiter>.</span><span class=keyword>await</span>
</span><span class=line><span class=punctuation.bracket>{</span>
</span><span class=line>    <span class=function.macro>println</span><span class=function.macro>!</span><span class=punctuation.bracket>(</span><span class=string>"{err}"</span><span class=punctuation.bracket>)</span><span class=punctuation.delimiter>;</span>
</span><span class=line><span class=punctuation.bracket>}</span>
</span></code></pre></div><h2 id=tcp/http>TCP/HTTP<a class=anchor href=#tcp/http>#</a></h2><p>开启 <code>http1</code> 或 <code>http2</code> 特性，默认 <code>http1</code> 已经开启。</p><h2 id=unix-sock-domain>Unix Sock Domain<a class=anchor href=#unix-sock-domain>#</a></h2><p>开启 <code>unix-socket</code> 特性，一般需要配合一个发代（例如：Nginx Proxy）。</p></article><nav class="flex-col gap-5 hidden lg:flex"><div class="py-1 text-2 uppercase">本页目录</div><ul class=text-3><li><a class="block py-1 font-normal transition-colors op75 hover:op100"href=#tcp/http>TCP/HTTP</a></li><li><a class="block py-1 font-normal transition-colors op75 hover:op100"href=#unix-sock-domain>Unix Sock Domain</a></li></ul></nav>